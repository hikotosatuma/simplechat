# Bedrock Chatbot with File Upload and QA Generation

Amazon Bedrock を使用したインテリジェントチャットボットアプリケーションで、ファイルアップロード、自動QA問題集生成、インタラクティブクイズ機能を備えています。

## 機能

### 基本チャット機能
- Amazon Bedrock Nova Lite モデルを使用した高度な会話AI
- Amazon Cognito によるセキュアなユーザー認証
- リアルタイム会話履歴管理

### ファイルアップロード・処理機能
- **対応ファイル形式**: PDF, PPT, PPTX, DOC, DOCX, TXT
- ドラッグ&ドロップによる直感的なファイルアップロード
- 自動テキスト抽出とインデックス化
- ファイル内容を参照した質問応答
- アップロードした資料はインメモリ処理されるため、非公開資料に対しても活用可能

### AI駆動QA問題集生成
- アップロードしたファイルから自動で問題集を生成
- **問題構成**: 4択問題4個、複数選択問題4個、記述問題2個（計10問）
- 3段階の難易度設定（低・中・高）
- マークダウン形式でのダウンロード機能

### インタラクティブクイズモード
- チャット内でリアルタイム問題回答
- 4択・複数選択問題の自動採点
- **記述問題のAI採点機能**: 採点ポイントに基づく詳細評価
- 進行状況表示と結果分析

### 履歴・管理機能
- 統合チャット履歴管理（会話、ファイル、QA情報を一元管理）
- 過去のチャットセッションの読み込み・削除
- QA問題集の再利用とダウンロード


### 🏗️ インフラストラクチャ
- API Gateway による安全な API アクセス
- CloudFront + S3 によるフロントエンドホスティング
- AWS CDK を使用したインフラのコード化
- Lambda による効率的なサーバーレス処理

## アーキテクチャ

![Architecture Diagram](./architecture.png)

## 前提条件

- [Node.js](https://nodejs.org/) (v14 以上)
- [AWS CLI](https://aws.amazon.com/cli/) (設定済み)
- [AWS CDK](https://aws.amazon.com/cdk/) (v2)
- [Python](https://www.python.org/) (v3.9 以上)

## セットアップ手順

### 重要: Bedrockモデルアクセス許可の設定

このアプリケーションを使用するには、AWS Bedrockのモデルへのアクセス許可が必要です。
以下の手順でモデルアクセスを有効にしてください：

1. AWS Managementコンソールにログイン
2. Amazon Bedrockサービスが利用可能なリージョン（us-east-1推奨）に移動
3. 左側のナビゲーションから「モデルアクセス」を選択
4. 使用するモデル（**us.amazon.nova-lite-v1:0**）の横にあるチェックボックスをオンにする
5. 画面下部の「次へ」ボタンをクリックし、内容を確認の上、「送信」をクリックする

**注意**: アクセス許可がない状態で環境をセットアップした場合、チャットボットは500エラーを返します。

### 1. リポジトリのクローン

```bash
git clone https://github.com/keisskaws/simplechat
cd simplechat
```

### 2. CDK プロジェクトの依存関係 && フロントエンドのビルド
```bash
npm install
```

### 3. AWS アカウントのブートストラップ（初回のみ）
```bash
npx cdk bootstrap
```

### 4. CDK スタックのデプロイ
```bash
npx cdk deploy
```

### 5. アプリケーションへのアクセス
デプロイ出力に表示された CloudFront URL にアクセスしてアプリケーションを使用します。

## 使用方法

### 基本的な使い方
1. CloudFront URL にアクセス
2. 「サインアップ」をクリックして新しいアカウントを作成
3. 登録したメールアドレスに送信された確認コードを入力
4. ログイン後、チャットインターフェースが表示

### ファイルアップロードとQA生成
1. サイドバーのドロップゾーンにファイルをドラッグ&ドロップ
2. ファイル処理完了後、難易度を選択してQA問題集を生成
3. 生成された問題集をダウンロードまたはプレビュー
4. 「チャットで問題に挑戦」でインタラクティブクイズを開始

### クイズモード
- 4択・複数選択問題: 選択肢を入力（例: A, B, C）
- 記述問題: 自由記述で回答、AI採点により詳細フィードバックを受信
- リアルタイム進行状況確認と最終結果表示

### チャット履歴管理
- 「チャット履歴」ボタンで過去のセッションを表示
- 各セッションの詳細情報（ファイル、QA、メッセージ数）を確認
- 過去のQA問題集を再ダウンロード可能

## カスタマイズ

### 別の Bedrock モデルの使用
`bin/bedrock-chatbot.ts` ファイルを編集して、使用するモデルを変更できます：

```typescript
new BedrockChatbotStack(app, 'BedrockChatbotStack', {
  modelId: 'us.amazon.nova-micro-v1:0', // モデルIDを変更
  // ...
});
```

### QA問題生成のカスタマイズ
`lambda/index.py` の QA生成プロンプトを編集して、問題の形式や内容をカスタマイズできます。

### フロントエンドのカスタマイズ
フロントエンドのコードは `frontend/src` ディレクトリにあります。React コンポーネントを編集してUI/UXをカスタマイズできます。

```bash
cd frontend
# src/ 配下のファイルを編集
npm run build
cd ..
npx cdk deploy
```

## トラブルシューティング

### 500 エラーの対処
1. AWS Lambda のログを確認
2. Bedrock モデルへのアクセス許可を確認
3. API Gateway のテスト機能で動作確認

### ファイルアップロードエラー
- サポートされているファイル形式を確認
- ファイルサイズ制限（通常10MB以下）
- ファイルの破損やパスワード保護の確認

### QA生成がうまくいかない場合
- ファイル内容にテキストが含まれているか確認
- 難易度設定を変更して再試行
- Lambda のタイムアウト設定を確認

## クリーンアップ
プロジェクトのリソースを削除するには以下のコマンドを実行します：

```bash
npx cdk destroy
```

## 技術仕様

- **フロントエンド**: React.js, AWS Amplify UI
- **バックエンド**: AWS Lambda (Python), Amazon Bedrock
- **認証**: Amazon Cognito
- **ストレージ**: Amazon S3, インメモリ処理（永続化なし）
- **API**: Amazon API Gateway
- **配信**: Amazon CloudFront
- **インフラ**: AWS CDK (TypeScript)


### トラブルシューティング
# API 呼び出しエラー
Cognito トークンが正しく設定されているか確認してください
API Gateway の CORS 設定が正しいか確認してください
CloudWatch Logs で Lambda 関数のログを確認してください

# 認証エラー
ユーザープールの設定を確認してください
フロントエンドの環境変数が正しく設定されているか確認してください
